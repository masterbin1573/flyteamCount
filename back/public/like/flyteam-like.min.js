/**
 * 飞天蒜子点赞功能 v1.0.0 | https://countapi.flyteam.cloud
 */
!function(){"use strict";const e={API_BASE:"https://api.flyteam.cloud",VERSION:"1.0.0",DEBUG:!1,DEBOUNCE_TIME:1e3,ANIMATION_DURATION:300};function t(...t){e.DEBUG&&console.log("[飞天点赞]",...t)}function n(...e){console.error("[飞天点赞]",...e)}function o(e,t){let n;return function(...o){const i=()=>{clearTimeout(n),e(...o)};clearTimeout(n),n=setTimeout(i,t)}}function i(){return{url:window.location.href,path:window.location.pathname+window.location.search,title:document.title,domain:window.location.hostname}}function l(e,t="info"){const n=document.createElement("div");n.className=`flyteam-message flyteam-message-${t}`,n.textContent=e,n.style.cssText=`position:fixed;top:20px;right:20px;background:${"success"===t?"#67c23a":"error"===t?"#f56c6c":"#409eff"};color:white;padding:12px 20px;border-radius:4px;box-shadow:0 2px 8px rgba(0,0,0,0.1);z-index:10000;font-size:14px;max-width:300px;opacity:0;transform:translateX(100%);transition:all 0.3s ease;`,document.body.appendChild(n),setTimeout(()=>{n.style.opacity="1",n.style.transform="translateX(0)"},10),setTimeout(()=>{n.style.opacity="0",n.style.transform="translateX(100%)",setTimeout(()=>{document.body.removeChild(n)},300)},3e3)}function s(t){t.style.transform="scale(1.2)",t.style.transition=`transform ${e.ANIMATION_DURATION}ms ease`,setTimeout(()=>{t.style.transform="scale(1)"},e.ANIMATION_DURATION)}async function a(t){try{const o=await fetch(`${e.API_BASE}/api/likes/count?path=${encodeURIComponent(t)}`);if(!o.ok)throw new Error(`HTTP ${o.status}`);const i=await o.json();return t("获取点赞数量成功",i),i.success?i.data:null}catch(e){return n("获取点赞数量失败:",e),null}}async function c(t,o){try{const i=await fetch(`${e.API_BASE}/api/likes/toggle`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t,title:o})});if(!i.ok){if(401===i.status)return l("需要登录后才能点赞，请先注册登录","error"),null;throw new Error(`HTTP ${i.status}`)}const s=await i.json();if(t("点赞操作成功",s),s.success){const{liked:e,count:t}=s.data;return l(e?"点赞成功 ❤️":"取消点赞",e?"success":"info"),{liked:e,count:t}}return null}catch(e){return n("点赞操作失败:",e),l("点赞失败，请稍后重试","error"),null}}function r(n){const r=i();let u=!1,d=0,f=!1;n.style.cursor||(n.style.cursor="pointer"),n.classList.add("flyteam-like-btn");const m=o(async()=>{if(f)return;f=!0,n.style.opacity="0.7";const e=await c(r.path,r.title);e&&(u=e.liked,d=e.count,p(),s(n)),f=!1,n.style.opacity="1"},e.DEBOUNCE_TIME);function p(){const e=n.dataset.originalText||n.textContent;let t=e,o="{{count}}",i="{{icon}}";/\d+/.test(t)?t=t.replace(/\d+/,o):t.includes(o)||(t=t+" "+o),t.includes(i)?t.includes("❤️")||t.includes("♡")||t.includes("♥")?t=t.replace(/[❤️♡♥]/,i):t=i+" "+t:t.includes("❤️")||t.includes("♡")||t.includes("♥")?t=t.replace(/[❤️♡♥]/,i):t=i+" "+t;const l=u?"❤️":"♡",s=t.replace(i,l).replace(o,d.toString());n.innerHTML=s,u?(n.classList.add("flyteam-liked"),n.style.color="#e74c3c"):(n.classList.remove("flyteam-liked"),n.style.color="")}n.addEventListener("click",m),n.dataset.originalText=n.textContent,a(r.path).then(e=>{e&&(d=e.count||0,u=e.liked||!1,p())}),t("点赞按钮初始化完成",n)}function u(){const e=new Set;["[data-flyteam-like]",".flyteam-like",".like-btn","[id*=\"like\"]","[class*=\"like\"]"].forEach(t=>{document.querySelectorAll(t).forEach(t=>{t.classList.contains("flyteam-like-btn")||e.add(t)})}),e.forEach(e=>{r(e)}),e.size>0&&t(`自动初始化了 ${e.size} 个点赞按钮`)}function d(e){"string"==typeof e?(document.querySelectorAll(e).forEach(r),t(`手动初始化了 ${document.querySelectorAll(e).length} 个点赞按钮`)):e&&"object"==typeof e?(r(e),t("手动初始化了 1 个点赞按钮")):u()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u):setTimeout(u,0),window.flyteamLike={version:e.VERSION,init:d,config:e,like:d};const f=document.createElement("style");f.textContent=".flyteam-like-btn{transition:all 0.3s ease;user-select:none}.flyteam-like-btn:hover{transform:translateY(-1px);box-shadow:0 2px 8px rgba(0,0,0,0.1)}.flyteam-like-btn:active{transform:translateY(0)}.flyteam-like-btn.flyteam-liked{color:#e74c3c!important}",document.head.appendChild(f),t("飞天点赞脚本加载完成 v"+e.VERSION)}();